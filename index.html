<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>å¬å–šè–ç´¢ï¼šæœªä¾†æˆ°å ´</title>
    <style>
        body { font-family: sans-serif; background: #1a1a1a; color: white; display: flex; flex-direction: column; align-items: center; margin: 0; padding: 20px; }
        .stats { background: #333; width: 100%; max-width: 800px; padding: 15px; display: flex; justify-content: space-around; border-radius: 10px; margin-bottom: 20px; border-bottom: 3px solid #00d4ff; }
        .container { display: flex; gap: 20px; width: 100%; max-width: 1000px; }
        .zone { flex: 1; background: #2d2d2d; padding: 15px; border-radius: 10px; border: 1px solid #444; height: 600px; display: flex; flex-direction: column; }
        
        /* å¡ç‰‡é¡è‰² */
        .card-slot { padding: 10px; margin: 5px; border-radius: 8px; text-align: center; display: inline-block; width: 80px; font-size: 12px; }
        .rank-0 { background: #eee; color: #333; }
        .rank-1 { background: #4caf50; color: white; }
        .rank-2 { background: #2196f3; color: white; }
        .rank-3 { background: #9c27b0; color: white; }
        .rank-4 { background: #ff9800; color: white; box-shadow: 0 0 10px gold; }

        /* æ€ªç‰©é¡¯ç¤º */
        .monster-list { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; overflow-y: auto; }
        .monster { background: #3e4a2a; padding: 10px; border-radius: 5px; text-align: center; border: 1px solid #8bc34a; }
        .hp-bar { background: #000; height: 8px; width: 100%; border-radius: 4px; margin-top: 5px; }
        .hp-fill { background: #ff4d4d; height: 100%; border-radius: 4px; transition: width 0.2s; }

        .log { height: 100px; overflow-y: auto; background: #000; color: #0f0; padding: 10px; font-size: 11px; margin-top: auto; }
    </style>
</head>
<body>

<div class="stats">
    <div>ğŸ’° é‡‘å¹£: <span id="gold">0</span></div>
    <div>âš”ï¸ ç§’å‚·: <span id="dps">0</span></div>
    <div>ğŸ’€ æ“Šæ®º: <span id="kills">0</span></div>
</div>

<div class="container">
    <div class="zone">
        <h3>å¬å–šè–ç´¢ (æŠ½å¡å€)</h3>
        <div id="inventory-display" style="overflow-y: auto; flex-grow: 1;"></div>
        <div class="log" id="game-log">å¬å–šé™£å•Ÿå‹•ä¸­...</div>
    </div>

    <div class="zone">
        <h3>æœªä¾†æˆ°å ´ (å“¥å¸ƒæ— Lv.<span id="g-lv">1</span>)</h3>
        <div class="monster-list" id="battle-field"></div>
    </div>
</div>

<script>
    const RARITIES = ["ç™½è‰²", "ç¶ è‰²", "è—è‰²", "ç´«è‰²", "æ©™è‰²"];
    const CHARACTERS = {
        "é›·ç´": { startRank: 0, chance: 0.50, baseAtk: 1, grow: 1 },
        "å‚‘æ": { startRank: 1, chance: 0.15, baseAtk: 20, grow: 2 },
        "ç‘èŒ²": { startRank: 2, chance: 0.05, baseAtk: 50, grow: 5 },
        "éœ“è™¹": { startRank: 3, chance: 0.01, baseAtk: 100, grow: 10 },
        "é›¢æ‰€": { startRank: 4, chance: 0.001, baseAtk: 500, grow: 50 }
    };

    let data = JSON.parse(localStorage.getItem('game_save_v2')) || { inv: {}, gold: 0, kills: 0 };
    let monsters = [];

    function save() { localStorage.setItem('game_save_v2', JSON.stringify(data)); }

    function getAtk(name, rank, lv) {
        let c = CHARACTERS[name];
        let atk = c.baseAtk + (lv - 1) * c.grow;
        return atk * Math.pow(2, rank - c.startRank);
    }

    function drawCard() {
        let roll = Math.random();
        let current = 0;
        for (let n in CHARACTERS) {
            current += CHARACTERS[n].chance;
            if (roll < current) { addCard(n, CHARACTERS[n].startRank, 1); return; }
        }
    }

    function addCard(n, r, l) {
        let key = `${n}-${r}-${l}`;
        data.inv[key] = (data.inv[key] || 0) + 1;
        if (data.inv[key] >= 10) {
            data.inv[key] -= 10;
            let nl = l + 1, nr = r;
            if (nl > 10) { nl = 1; nr++; }
            if (nr < 5) addCard(n, nr, nl);
        }
        updateUI();
    }

    function spawn() {
        if (monsters.length < 10) {
            let mult = Math.pow(2, Math.floor(data.kills / 100));
            monsters.push({ hp: 10 * mult, max: 10 * mult, gold: 1 * mult });
        }
    }

    function updateUI() {
        save();
        document.getElementById('gold').innerText = Math.floor(data.gold);
        document.getElementById('kills').innerText = data.kills;
        document.getElementById('g-lv').innerText = Math.floor(data.kills / 100) + 1;
        
        let dps = 0;
        let html = "";
        for (let k in data.inv) {
            if (data.inv[k] <= 0) continue;
            let [n, r, l] = k.split('-');
            let a = getAtk(n, parseInt(r), parseInt(l));
            dps += a * data.inv[k];
            html += `<div class="card-slot rank-${r}"><b>${n}</b><br>Lv.${l}<br>ğŸ”¥${Math.floor(a)}<br>x${data.inv[k]}</div>`;
        }
        document.getElementById('dps').innerText = Math.floor(dps);
        document.getElementById('inventory-display').innerHTML = html;
        window.currentDPS = dps;
    }

    setInterval(() => {
        drawCard();
        if (monsters.length > 0 && window.currentDPS > 0) {
            monsters[0].hp -= window.currentDPS;
            if (monsters[0].hp <= 0) {
                let m = monsters.shift();
                data.gold += m.gold;
                data.kills++;
            }
        }
        let mHtml = "";
        monsters.forEach(m => {
            mHtml += `<div class="monster">ğŸ‘º å“¥å¸ƒæ—<div class="hp-bar"><div class="hp-fill" style="width:${(m.hp/m.max)*100}%"></div></div></div>`;
        });
        document.getElementById('battle-field').innerHTML = mHtml;
        updateUI();
    }, 1000);

    setInterval(spawn, 10000);
    updateUI();
</script>
</body>
</html>
