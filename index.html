<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>å¬å–šè–ç´¢ï¼šæœªä¾†æˆ°å ´ v3.2</title>
    <style>
        body { font-family: 'Microsoft JhengHei', sans-serif; background: #121212; color: white; margin: 0; padding: 15px; display: flex; flex-direction: column; align-items: center; }
        .stats { background: #1e1e1e; width: 100%; max-width: 900px; padding: 15px; display: flex; justify-content: space-around; border-radius: 12px; margin-bottom: 15px; border: 1px solid #00d4ff; box-shadow: 0 0 10px rgba(0,212,255,0.2); }
        .container { display: flex; gap: 15px; width: 100%; max-width: 900px; height: 500px; }
        .zone { flex: 1; background: #252525; padding: 15px; border-radius: 12px; border: 1px solid #444; display: flex; flex-direction: column; overflow: hidden; }
        
        .inventory-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 10px; overflow-y: auto; flex-grow: 1; padding: 5px; }
        .card-slot { padding: 10px; border-radius: 8px; text-align: center; font-size: 11px; border: 1px solid rgba(255,255,255,0.1); }
        .avatar { width: 50px; height: 50px; object-fit: cover; border-radius: 50%; background: #444; margin: 0 auto 5px; display: block; }
        
        .rank-0 { background: #e0e0e0; color: #222; }
        .rank-1 { background: #43a047; color: white; }
        .rank-2 { background: #1e88e5; color: white; }
        .rank-3 { background: #8e24aa; color: white; }
        .rank-4 { background: #fb8c00; color: white; box-shadow: 0 0 8px gold; border: 1px solid gold; }

        .monster-list { display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; overflow-y: auto; flex-grow: 1; padding: 5px; align-content: start; }
        .monster { background: #333; padding: 8px; border-radius: 6px; border-left: 4px solid #f44336; font-size: 12px; text-align: center; min-height: 80px; }
        .monster-img { width: 40px; height: 40px; object-fit: contain; margin: 0 auto 5px; display: block; background: #444; }
        .hp-bar { background: #000; height: 6px; width: 100%; border-radius: 3px; margin-top: 5px; }
        .hp-fill { background: #ff5252; height: 100%; border-radius: 3px; }

        .detail-panel { width: 100%; max-width: 900px; background: #1a1a1a; margin-top: 15px; border-radius: 12px; border: 1px solid #555; height: 150px; display: flex; flex-direction: column; }
        .log-content { flex-grow: 1; overflow-y: auto; padding: 10px; font-family: monospace; font-size: 12px; color: #00ff00; }
    </style>
</head>
<body>

<div class="stats">
    <div>ğŸ’° é‡‘å¹£: <span id="gold">0</span></div>
    <div>âš”ï¸ ç¸½ç§’å‚·: <span id="dps">0</span></div>
    <div>ğŸ’€ ç¸½æ“Šæ®º: <span id="kills">0</span></div>
</div>

<div class="container">
    <div class="zone">
        <h3>âœ¨ å¬å–šè–ç´¢</h3>
        <div id="inventory-display" class="inventory-grid"></div>
    </div>
    <div class="zone">
        <h3>ğŸ”¥ æœªä¾†æˆ°å ´ (Lv.<span id="g-lv">1</span>)</h3>
        <div id="battle-field" class="monster-list"></div>
    </div>
</div>

<div class="detail-panel">
    <div id="game-log" class="log-content"></div>
</div>

<script>
    const CHARACTERS = {
        "é›·ç´": { startRank: 0, chance: 0.50, baseAtk: 1, grow: 1, img: "image/reyna.png" },
        "å‚‘æ": { startRank: 1, chance: 0.15, baseAtk: 20, grow: 2, img: "image/jett.png" },
        "ç‘èŒ²": { startRank: 2, chance: 0.05, baseAtk: 50, grow: 5, img: "image/raz.png" },
        "éœ“è™¹": { startRank: 3, chance: 0.01, baseAtk: 100, grow: 10, img: "image/neon.png" },
        "é›¢æ‰€": { startRank: 4, chance: 0.001, baseAtk: 500, grow: 50, img: "image/iso.png" }
    };
    const MONSTER_IMG = "image/goblin.png";

    let data = JSON.parse(localStorage.getItem('game_v3_2')) || { inv: {}, gold: 0, kills: 0 };
    let monsters = [];

    function addLog(msg, color = "#0f0") {
        const logBox = document.getElementById('game-log');
        logBox.innerHTML = `<div>[${new Date().toLocaleTimeString()}] ${msg}</div>` + logBox.innerHTML;
    }

    function updateUI() {
        localStorage.setItem('game_v3_2', JSON.stringify(data));
        document.getElementById('gold').innerText = Math.floor(data.gold).toLocaleString();
        document.getElementById('kills').innerText = data.kills;
        document.getElementById('g-lv').innerText = Math.floor(data.kills / 100) + 1;
        
        let dps = 0;
        let html = "";
        for (let k in data.inv) {
            if (data.inv[k] <= 0) continue;
            let [n, r, l] = k.split('-');
            let c = CHARACTERS[n];
            let atk = (c.baseAtk + (l - 1) * c.grow) * Math.pow(2, r - c.startRank);
            dps += atk * data.inv[k];
            html += `<div class="card-slot rank-${r}">
                <img src="${c.img}" class="avatar" alt="${n}">
                <b>${n}</b><br>Lv.${l}<br>âš”ï¸${Math.floor(atk)}<br>x${data.inv[k]}
            </div>`;
        }
        document.getElementById('dps').innerText = Math.floor(dps).toLocaleString();
        document.getElementById('inventory-display').innerHTML = html;
        window.currentDPS = dps;
    }

    setInterval(() => {
        // æŠ½å¡é‚è¼¯
        let roll = Math.random();
        let cur = 0;
        for (let n in CHARACTERS) {
            cur += CHARACTERS[n].chance;
            if (roll < cur) {
                let key = `${n}-${CHARACTERS[n].startRank}-1`;
                data.inv[key] = (data.inv[key] || 0) + 1;
                // è‡ªå‹•åˆæˆ
                if (data.inv[key] >= 10) {
                    data.inv[key] -= 10;
                    let nextL = 2, nextR = CHARACTERS[n].startRank;
                    let nextKey = `${n}-${nextR}-${nextL}`;
                    data.inv[nextKey] = (data.inv[nextKey] || 0) + 1;
                    addLog(`âœ¨ ${n} åˆæˆæˆåŠŸï¼`, "yellow");
                }
                break;
            }
        }

        // ç”Ÿæˆæ€ªç‰©
        if (monsters.length < 10) {
            let mult = Math.pow(2, Math.floor(data.kills / 100));
            monsters.push({ hp: 10 * mult, max: 10 * mult, gold: 1 * mult });
        }
        
        // æˆ°é¬¥é‚è¼¯
        if (monsters.length > 0 && window.currentDPS > 0) {
            monsters[0].hp -= window.currentDPS;
            if (monsters[0].hp <= 0) {
                let m = monsters.shift();
                data.gold += m.gold;
                data.kills++;
                addLog(`ğŸ’€ æ“Šæ®ºæ€ªç‰©ç²å¾— ${m.gold}`, "gold");
            }
        }
        
        // æ¸²æŸ“æˆ°å ´
        let mHtml = "";
        monsters.forEach((m, idx) => {
            let p = (m.hp / m.max) * 100;
            mHtml += `<div class="monster">
                <img src="${MONSTER_IMG}" class="monster-img" alt="G">
                ${idx === 0 ? "ğŸ¯" : ""}å“¥å¸ƒæ—
                <div class="hp-bar"><div class="hp-fill" style="width:${p}%"></div></div>
            </div>`;
        });
        document.getElementById('battle-field').innerHTML = mHtml;
        updateUI();
    }, 1000);
</script>
</body>
</html>
